@page "/"
@using SharedModels
@inject HttpClient Http

<PageTitle>Home</PageTitle>

<div class="h-100 d-flex flex-column justify-content-center align-items-center">

    <button class="btn btn-primary" @onclick="FetchExerciseData">Fetch Exercise Data</button>
    @if (Exercises != null)
    {
        @foreach (var exercise in Exercises)
        {
            <p class="body-part">@exercise.BodyPart</p>
            <p class="equipment">@exercise.Equipment</p>
            <img src="@exercise.GifUrl" alt="Exercise Gif" title="GIF of exercise: @exercise.Name" />
            <p class="id">@exercise.Id</p>
            <p class="name">@exercise.Name</p>
            <p class="target">@exercise.Target</p>
            @if (exercise.SecondaryMuscles != null)
            {
                foreach (var muscle in exercise.SecondaryMuscles)
                {
                    <p class="secondary-muscles">@muscle</p>
                }
            }
            @if (exercise.Instructions != null)
            {
                foreach (var instruction in exercise.Instructions)
                {
                    <p class="instructions">@instruction</p>
                }
            }
        }
    }
    <button class="btn btn-primary" @onclick="FetchBodyPartData">Fetch Body Part Data</button>
    @if (BodyParts != null)
    {
        @foreach (var bodyPart in BodyParts)
        {
            <p>@bodyPart</p>
        }
    }
    <button class="btn btn-primary" @onclick="FetchEquipmentData">Fetch Equipment Data</button>
    @if (AllEquipment != null)
    {
        @foreach (var equipment in AllEquipment)
        {
            <p>@equipment</p>
        }
    }
    <button class="btn btn-primary" @onclick="FetchTargetMuscleData">Fetch Target Muscle Data</button>
    @if (TargetMuscles != null)
    {
        @foreach (var targetMuscle in TargetMuscles)
        {
            <p>@targetMuscle</p>
        }
    }
    <input type="text" @bind="searchTerm" placeholder="Search..." />
    <button @onclick="HandleSearch">Search</button>

    @if (searchedExercises != null)
    {
        @foreach (var exercise in searchedExercises)
        {
            <p class="body-part">@exercise.BodyPart</p>
            <p class="equipment">@exercise.Equipment</p>
            <img src="@exercise.GifUrl" alt="Exercise Gif" title="GIF of exercise: @exercise.Name" />
            <p class="id">@exercise.Id</p>
            <p class="name">@exercise.Name</p>
            <p class="target">@exercise.Target</p>
            @if (exercise.SecondaryMuscles != null)
            {
                foreach (var muscle in exercise.SecondaryMuscles)
                {
                    <p class="secondary-muscles">@muscle</p>
                }
            }
            @if (exercise.Instructions != null)
            {
                foreach (var instruction in exercise.Instructions)
                {
                    <p class="instructions">@instruction</p>
                }
            }
        }
    }
</div>

@code {

    private Exercise[]? Exercises;

    private async Task FetchExerciseData()
    {
        Exercises = await Http.GetFromJsonAsync<Exercise[]>("https://localhost:7024/exercises");
    }

    private string[]? BodyParts;

    private async Task FetchBodyPartData()
    {
        BodyParts = await Http.GetFromJsonAsync<string[]>("https://localhost:7024/bodyparts");
    }

    private string[]? AllEquipment;

    private async Task FetchEquipmentData()
    {
        AllEquipment = await Http.GetFromJsonAsync<string[]>("https://localhost:7024/allequipment");
    }

    private string[]? TargetMuscles;

    private async Task FetchTargetMuscleData()
    {
        TargetMuscles = await Http.GetFromJsonAsync<string[]>("https://localhost:7024/targetmuscles");
    }

    private string searchTerm = "";
    private List<Exercise>? allExercises;
    private List<Exercise>? searchedExercises;

    protected override async Task OnInitializedAsync()
    {
        allExercises = await Http.GetFromJsonAsync<List<Exercise>>("https://localhost:7024/exercises");
    }

    private void HandleSearch()
    {
        if (!string.IsNullOrWhiteSpace(searchTerm))
        {
            searchedExercises = allExercises?.Where(exercise =>
                exercise.Name?.ToLower().Contains(searchTerm.ToLower()) == true ||
                exercise.Target?.ToLower().Contains(searchTerm.ToLower()) == true ||
                exercise.Equipment?.ToLower().Contains(searchTerm.ToLower()) == true ||
                exercise.BodyPart?.ToLower().Contains(searchTerm.ToLower()) == true
            ).ToList();
        }
        else
        {
            searchedExercises = allExercises;
        }
    }
}
}

}
